<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.vueboard.domains.board.mapper.BoardMapper">

	<select id="selectBoardsByPage"
		resultType="com.vueboard.domains.board.entity.Board">
		SELECT * FROM (
		SELECT ROWNUM AS rnum, A.* FROM (
		SELECT
		BOARD_ID AS boardId,
		TITLE,
		WRITER,
		CONTENT,
		PN,
		CATEGORY,
		REGDATE,
		VIEWCNT
		FROM TB_BOARD
		ORDER BY BOARD_ID DESC
		) A
		)
		WHERE rnum BETWEEN #{offset}+1
		AND #{offset}+#{size}

	</select>

	<select id="selectRecentFiveBoards"
		resultType="com.vueboard.domains.board.entity.Board">
		SELECT * FROM (
		SELECT ROWNUM AS rnum, A.* FROM (
		SELECT
		BOARD_ID AS boardId,
		TITLE,
		WRITER,
		CONTENT,
		PN,
		CATEGORY,
		REGDATE,
		VIEWCNT
		FROM TB_BOARD
		ORDER BY BOARD_ID DESC
		) A
		)
		WHERE rnum BETWEEN 1 AND 5

	</select>

	<select id="selectTotalCount" resultType="int">
		SELECT COUNT(*) FROM
		TB_BOARD
	</select>

	<select id="getBoardById" parameterType="long"
		resultType="com.vueboard.domains.board.entity.Board">
		SELECT
		BOARD_ID AS boardId,
		TITLE,
		WRITER,
		CONTENT,
		PN,
		CATEGORY,
		REGDATE,
		VIEWCNT
		FROM TB_BOARD
		WHERE BOARD_ID = #{boardId}
	</select>
	<!--useGeneratedKeys, keyProperty: 
	방금 insert한 auto increment가 걸린 pk값을 바로 사용하고 싶을 떄 사용한다.  -->
	<insert id="insertBoard"
		parameterType="com.vueboard.domains.board.entity.Board"
		useGeneratedKeys="true" keyProperty="boardId"
		keyColumn="BOARD_ID">
		INSERT INTO TB_BOARD
		(TITLE,
		CONTENT, WRITER, PN, REGDATE, VIEWCNT)
		VALUES
		(#{title}, #{content},
		#{writer}, #{pn}, SYSDATE, 0)
	</insert>

	<update id="updateBoard"
		parameterType="com.vueboard.domains.board.entity.Board">
		UPDATE TB_BOARD
		SET TITLE = #{title},
		CONTENT =
		#{content},
		REGDATE = SYSDATE
		WHERE BOARD_ID = #{boardId}
	</update>

	<delete id="deleteBoard" parameterType="long">
		DELETE FROM TB_BOARD
		WHERE BOARD_ID = #{boardId}
	</delete>

</mapper>
